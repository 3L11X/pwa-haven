"use strict";var Module=function(e={}){var t,r,n;e.ready=new Promise(((e,r)=>{t=e}));let a=null;var o,s,i,u,l,c,f,d,p,h,g;function y(e){throw e}function v(){var e=h.buffer;s=new Int8Array(e),i=new Int16Array(e),u=new Int32Array(e),l=new Uint8Array(e),c=new Uint16Array(e),f=new Uint32Array(e),d=new Float32Array(e),p=new Float64Array(e)}r=e=>{"JASSUB: No usable fontconfig configuration file found, using fallback."===e?console.debug(e):console.log(e)},n=e=>{"Fontconfig error: Cannot load default config file: No such file: (null)"===e?console.debug(e):console.error(e)},o=v,v=()=>{o(),self.wasmMemory=h,self.HEAPU8C=new Uint8ClampedArray(h.buffer),self.HEAPU8=new Uint8Array(h.buffer)},String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return void 0===t&&(t=0),this.substring(t,e.length)===e}),String.prototype.includes||(String.prototype.includes=function(e,t){return-1!==this.indexOf(e,t)}),h=new WebAssembly.Memory({initial:256,maximum:32768}),v();var m=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function b(e,t,r){for(var n=t+r,a=t;e[a]&&!(a>=n);)++a;if(a-t>16&&e.buffer&&m)return m.decode(e.subarray(t,a));for(var o="";t<a;){var s=e[t++];if(128&s){var i=63&e[t++];if(192!=(224&s)){var u=63&e[t++];if((s=224==(240&s)?(15&s)<<12|i<<6|u:(7&s)<<18|i<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(s);else{var l=s-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else o+=String.fromCharCode((31&s)<<6|i)}else o+=String.fromCharCode(s)}return o}function C(e,t){return e?b(l,e,t):""}function w(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var $=void 0;function T(e){for(var t="",r=e;l[r];)t+=$[l[r++]];return t}var P={},A={},S={};function j(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function O(e,t){return{[e=j(e)]:function(){return t.apply(this,arguments)}}[e]}function F(e,t){var r=O(t,(function(e){this.name=t,this.message=e;var r=new Error(e).stack;void 0!==r&&(this.stack=this.toString()+"\n"+r.replace(/^Error(:[^\n]*)?\n/,""))}));return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},r}var M=void 0;function _(e){throw new M(e)}var k=void 0;function W(e){throw new k(e)}function E(e,t,r){function n(t){var n=r(t);n.length!==e.length&&W("Mismatched type converter count");for(var a=0;a<e.length;++a)R(e[a],n[a])}e.forEach((function(e){S[e]=t}));var a=new Array(t.length),o=[],s=0;t.forEach(((e,t)=>{A.hasOwnProperty(e)?a[t]=A[e]:(o.push(e),P.hasOwnProperty(e)||(P[e]=[]),P[e].push((()=>{a[t]=A[e],++s===o.length&&n(a)})))})),0===o.length&&n(a)}function R(e,t,r={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||_(`type "${n}" must have a positive integer typeid pointer`),A.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;_(`Cannot register type '${n}' twice`)}if(A[e]=t,delete S[e],P.hasOwnProperty(e)){var a=P[e];delete P[e],a.forEach((e=>e()))}}function x(e){return{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}}function I(e){_(e.$$.ptrType.registeredClass.name+" instance already deleted")}var D=!1;function U(e){}function B(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function L(e,t,r){if(t===r)return e;if(void 0===r.baseClass)return null;var n=L(e,t,r.baseClass);return null===n?null:r.downcast(n)}var V={};var N=[];function z(){for(;N.length;){var e=N.pop();e.$$.deleteScheduled=!1,e.delete()}}var H=void 0;var G={};function J(e,t){return(!t.ptrType||!t.ptr)&&W("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&W("Both smartPtrType and smartPtr must be specified"),t.count={value:1},q(Object.create(e,{$$:{value:t}}))}function q(e){return typeof FinalizationRegistry>"u"?(q=e=>e,e):(D=new FinalizationRegistry((e=>{B(e.$$)})),U=e=>D.unregister(e),(q=e=>{var t=e.$$;if(t.smartPtr){var r={$$:t};D.register(e,r,e)}return e})(e))}function K(){}function Y(e,t,r){if(void 0===e[t].overloadTable){var n=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||_(`Function '${r}' called with an invalid number of arguments (${arguments.length}) - expects one of (${e[t].overloadTable})!`),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}}function X(e,t,r,n,a,o,s,i){this.name=e,this.constructor=t,this.instancePrototype=r,this.rawDestructor=n,this.baseClass=a,this.getActualType=o,this.upcast=s,this.downcast=i,this.pureVirtualFunctions=[]}function Z(e,t,r){for(;t!==r;)t.upcast||_(`Expected null or instance of ${r.name}, got an instance of ${t.name}`),e=t.upcast(e),t=t.baseClass;return e}function Q(e,t){if(null===t)return this.isReference&&_("null is not a valid "+this.name),0;t.$$||_(`Cannot pass "${ve(t)}" as a ${this.name}`),t.$$.ptr||_("Cannot pass deleted object as a pointer of type "+this.name);var r=t.$$.ptrType.registeredClass;return Z(t.$$.ptr,r,this.registeredClass)}function ee(e,t){var r;if(null===t)return this.isReference&&_("null is not a valid "+this.name),this.isSmartPointer?(r=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,r),r):0;t.$$||_(`Cannot pass "${ve(t)}" as a ${this.name}`),t.$$.ptr||_(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&t.$$.ptrType.isConst&&_(`Cannot convert argument of type ${t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name} to parameter type ${this.name}`);var n=t.$$.ptrType.registeredClass;if(r=Z(t.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&_("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?r=t.$$.smartPtr:_(`Cannot convert argument of type ${t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:r=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)r=t.$$.smartPtr;else{var a=t.clone();r=this.rawShare(r,ye.toHandle((function(){a.delete()}))),null!==e&&e.push(this.rawDestructor,r)}break;default:_("Unsupporting sharing policy")}return r}function te(e,t){if(null===t)return this.isReference&&_("null is not a valid "+this.name),0;t.$$||_(`Cannot pass "${ve(t)}" as a ${this.name}`),t.$$.ptr||_(`Cannot pass deleted object as a pointer of type ${this.name}`),t.$$.ptrType.isConst&&_(`Cannot convert argument of type ${t.$$.ptrType.name} to parameter type ${this.name}`);var r=t.$$.ptrType.registeredClass;return Z(t.$$.ptr,r,this.registeredClass)}function re(e){return this.fromWireType(u[e>>2])}function ne(e,t,r,n,a,o,s,i,u,l,c){this.name=e,this.registeredClass=t,this.isReference=r,this.isConst=n,this.isSmartPointer=a,this.pointeeType=o,this.sharingPolicy=s,this.rawGetPointee=i,this.rawConstructor=u,this.rawShare=l,this.rawDestructor=c,a||void 0!==t.baseClass?this.toWireType=ee:n?(this.toWireType=Q,this.destructorFunction=null):(this.toWireType=te,this.destructorFunction=null)}var ae=[];function oe(e){var t=ae[e];return t||(e>=ae.length&&(ae.length=e+1),ae[e]=t=g.get(e)),t}function se(e,t,r){return e.includes("j")?function(e,t,r){var n=dynCalls[e];return r&&r.length?n.apply(null,[t].concat(r)):n.call(null,t)}(e,t,r):oe(t).apply(null,r)}function ie(e,t){var r=(e=T(e)).includes("j")?function(e,t){var r=[];return function(){return r.length=0,Object.assign(r,arguments),se(e,t,r)}}(e,t):oe(t);return"function"!=typeof r&&_(`unknown function pointer with signature ${e}: ${t}`),r}var ue=void 0;function le(e){var t=xe(e),r=T(t);return Re(t),r}function ce(e,t){var r=[],n={};throw t.forEach((function e(t){if(!n[t]&&!A[t]){if(S[t])return void S[t].forEach(e);r.push(t),n[t]=!0}})),new ue(e+": "+r.map(le).join([", "]))}function fe(e,t){for(var r=[],n=0;n<e;n++)r.push(f[t+4*n>>2]);return r}function de(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function pe(e,t,r,n,a,o){var s=t.length;s<2&&_("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var i=null!==t[1]&&null!==r,u=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){u=!0;break}var c="void"!==t[0].name,f="",d="";for(l=0;l<s-2;++l)f+=(0!==l?", ":"")+"arg"+l,d+=(0!==l?", ":"")+"arg"+l+"Wired";var p="return function "+j(e)+"("+f+") {\nif (arguments.length !== "+(s-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(s-2)+" args!');\n}\n";u&&(p+="var destructors = [];\n");var h=u?"destructors":"null",g=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],y=[_,n,a,de,t[0],t[1]];for(i&&(p+="var thisWired = classParam.toWireType("+h+", this);\n"),l=0;l<s-2;++l)p+="var arg"+l+"Wired = argType"+l+".toWireType("+h+", arg"+l+"); // "+t[l+2].name+"\n",g.push("argType"+l),y.push(t[l+2]);if(i&&(d="thisWired"+(d.length>0?", ":"")+d),p+=(c||o?"var rv = ":"")+"invoker(fn"+(d.length>0?", ":"")+d+");\n",u)p+="runDestructors(destructors);\n";else for(l=i?1:2;l<t.length;++l){var v=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==t[l].destructorFunction&&(p+=v+"_dtor("+v+"); // "+t[l].name+"\n",g.push(v+"_dtor"),y.push(t[l].destructorFunction))}return c&&(p+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),p+="}\n",g.push(p),function(e,t){if(!(e instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof e} which is not a function`);var r=O(e.name||"unknownFunctionName",(function(){}));r.prototype=e.prototype;var n=new r,a=e.apply(n,t);return a instanceof Object?a:n}(Function,g).apply(null,y)}function he(e,t,r){return e instanceof Object||_(r+' with invalid "this": '+e),e instanceof t.registeredClass.constructor||_(r+' incompatible with "this" of type '+e.constructor.name),e.$$.ptr||_(`cannot call emscripten binding method ${r} on deleted object`),Z(e.$$.ptr,e.$$.ptrType.registeredClass,t.registeredClass)}var ge=new function(){this.allocated=[void 0],this.freelist=[],this.get=function(e){return this.allocated[e]},this.allocate=function(e){var t=this.freelist.pop()||this.allocated.length;return this.allocated[t]=e,t},this.free=function(e){this.allocated[e]=void 0,this.freelist.push(e)}};var ye={toValue:e=>(e||_("Cannot use deleted val. handle = "+e),ge.get(e).value),toHandle:e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return ge.allocate({refcount:1,value:e})}}};function ve(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function me(e,t){switch(t){case 2:return function(e){return this.fromWireType(d[e>>2])};case 3:return function(e){return this.fromWireType(p[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function be(e,t,r){switch(t){case 0:return r?function(e){return s[e]}:function(e){return l[e]};case 1:return r?function(e){return i[e>>1]}:function(e){return c[e>>1]};case 2:return r?function(e){return u[e>>2]}:function(e){return f[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}var Ce,we=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function $e(e,t){for(var r=e,n=r>>1,a=n+t/2;!(n>=a)&&c[n];)++n;if((r=n<<1)-e>32&&we)return we.decode(l.subarray(e,r));for(var o="",s=0;!(s>=t/2);++s){var u=i[e+2*s>>1];if(0==u)break;o+=String.fromCharCode(u)}return o}function Te(e,t,r){if(void 0===r&&(r=2147483647),r<2)return 0;for(var n=t,a=(r-=2)<2*e.length?r/2:e.length,o=0;o<a;++o){var s=e.charCodeAt(o);i[t>>1]=s,t+=2}return i[t>>1]=0,t-n}function Pe(e){return 2*e.length}function Ae(e,t){for(var r=0,n="";!(r>=t/4);){var a=u[e+4*r>>2];if(0==a)break;if(++r,a>=65536){var o=a-65536;n+=String.fromCharCode(55296|o>>10,56320|1023&o)}else n+=String.fromCharCode(a)}return n}function Se(e,t,r){if(void 0===r&&(r=2147483647),r<4)return 0;for(var n=t,a=n+r-4,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),u[t>>2]=s,(t+=4)+4>a)break}return u[t>>2]=0,t-n}function je(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function Oe(e){var t=h.buffer;try{return h.grow(e-t.byteLength+65535>>>16),v(),1}catch{}}Ce=()=>performance.now();var Fe={};function Me(){if(!Me.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(var t in Fe)void 0===Fe[t]?delete e[t]:e[t]=Fe[t];var r=[];for(var t in e)r.push(t+"="+e[t]);Me.strings=r}return Me.strings}var _e=[null,[],[]];function ke(e,t){var a=_e[e];0===t||10===t?((1===e?r:n)(b(a,0)),a.length=0):a.push(t)}(function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);$=e})(),M=e.BindingError=F(Error,"BindingError"),k=e.InternalError=F(Error,"InternalError"),K.prototype.isAliasOf=function(e){if(!(this instanceof K&&e instanceof K))return!1;for(var t=this.$$.ptrType.registeredClass,r=this.$$.ptr,n=e.$$.ptrType.registeredClass,a=e.$$.ptr;t.baseClass;)r=t.upcast(r),t=t.baseClass;for(;n.baseClass;)a=n.upcast(a),n=n.baseClass;return t===n&&r===a},K.prototype.clone=function(){if(this.$$.ptr||I(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e=q(Object.create(Object.getPrototypeOf(this),{$$:{value:x(this.$$)}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e},K.prototype.delete=function(){this.$$.ptr||I(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&_("Object already scheduled for deletion"),U(this),B(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},K.prototype.isDeleted=function(){return!this.$$.ptr},K.prototype.deleteLater=function(){return this.$$.ptr||I(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&_("Object already scheduled for deletion"),N.push(this),1===N.length&&H&&H(z),this.$$.deleteScheduled=!0,this},e.getInheritedInstanceCount=function(){return Object.keys(G).length},e.getLiveInheritedInstances=function(){var e=[];for(var t in G)G.hasOwnProperty(t)&&e.push(G[t]);return e},e.flushPendingDeletes=z,e.setDelayFunction=function(e){H=e,N.length&&H&&H(z)},ne.prototype.getPointee=function(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e},ne.prototype.destructor=function(e){this.rawDestructor&&this.rawDestructor(e)},ne.prototype.argPackAdvance=8,ne.prototype.readValueFromPointer=re,ne.prototype.deleteObject=function(e){null!==e&&e.delete()},ne.prototype.fromWireType=function(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var r=function(e,t){return t=function(e,t){for(void 0===t&&_("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),G[t]}(this.registeredClass,t);if(void 0!==r){if(0===r.$$.count.value)return r.$$.ptr=t,r.$$.smartPtr=e,r.clone();var n=r.clone();return this.destructor(e),n}function a(){return this.isSmartPointer?J(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):J(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var o,s=this.registeredClass.getActualType(t),i=V[s];if(!i)return a.call(this);o=this.isConst?i.constPointerType:i.pointerType;var u=L(t,this.registeredClass,o.registeredClass);return null===u?a.call(this):this.isSmartPointer?J(o.registeredClass.instancePrototype,{ptrType:o,ptr:u,smartPtrType:this,smartPtr:e}):J(o.registeredClass.instancePrototype,{ptrType:o,ptr:u})},ue=e.UnboundTypeError=F(Error,"UnboundTypeError"),ge.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),ge.reserved=ge.allocated.length,e.count_emval_handles=function(){for(var e=0,t=ge.reserved;t<ge.allocated.length;++t)void 0!==ge.allocated[t]&&++e;return e};var We={b:function(e,t,r,n){y(`Assertion failed: ${C(e)}, at: `+[t?C(t):"unknown filename",r,n?C(n):"unknown function"])},k:function(e,t,r){return 0},I:function(e,t){},B:function(e,t,r){},K:function(e,t,r){return 0},G:function(e,t,r,n){},n:function(e,t,r,n){},H:function(e,t){},u:function(e,t,r,n,a){},r:function(e,t,r,n,a){var o=w(r);R(e,{name:t=T(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:a},argPackAdvance:8,readValueFromPointer:function(e){var n;if(1===r)n=s;else if(2===r)n=i;else{if(4!==r)throw new TypeError("Unknown boolean type size: "+t);n=u}return this.fromWireType(n[e>>o])},destructorFunction:null})},j:function(t,r,n,a,o,s,i,u,l,c,f,d,p){f=T(f),s=ie(o,s),u&&(u=ie(i,u)),c&&(c=ie(l,c)),p=ie(d,p);var h=j(f);(function(t,r,n){e.hasOwnProperty(t)?(_(`Cannot register public name '${t}' twice`),Y(e,t,t),e.hasOwnProperty(n)&&_(`Cannot register multiple overloads of a function with the same number of arguments (${n})!`),e[t].overloadTable[n]=r):e[t]=r})(h,(function(){ce(`Cannot construct ${f} due to unbound types`,[a])})),E([t,r,n],a?[a]:[],(function(r){var n,o;r=r[0],o=a?(n=r.registeredClass).instancePrototype:K.prototype;var i=O(h,(function(){if(Object.getPrototypeOf(this)!==l)throw new M("Use 'new' to construct "+f);if(void 0===d.constructor_body)throw new M(f+" has no accessible constructor");var e=d.constructor_body[arguments.length];if(void 0===e)throw new M(`Tried to invoke ctor of ${f} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(d.constructor_body).toString()}) parameters instead!`);return e.apply(this,arguments)})),l=Object.create(o,{constructor:{value:i}});i.prototype=l;var d=new X(f,i,l,p,n,s,u,c);d.baseClass&&(void 0===d.baseClass.__derivedClasses&&(d.baseClass.__derivedClasses=[]),d.baseClass.__derivedClasses.push(d));var g=new ne(f,d,!0,!1,!1),y=new ne(f+"*",d,!1,!1,!1),v=new ne(f+" const*",d,!1,!0,!1);return V[t]={pointerType:y,constPointerType:v},function(t,r,n){e.hasOwnProperty(t)||W("Replacing nonexistant public symbol"),e[t].overloadTable,e[t]=r,e[t].argCount=n}(h,i),[g,y,v]}))},A:function(e,t,r,n,a,o){!function(e,t){if(!e)throw void 0}(t>0);var s=fe(t,r);a=ie(n,a),E([],[e],(function(e){var r="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new M(`Cannot register multiple constructors with identical number of parameters (${t-1}) for class '${e.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return e.registeredClass.constructor_body[t-1]=()=>{ce(`Cannot construct ${e.name} due to unbound types`,s)},E([],s,(function(n){return n.splice(1,0,null),e.registeredClass.constructor_body[t-1]=pe(r,n,null,a,o),[]})),[]}))},d:function(e,t,r,n,a,o,s,i,u){var l=fe(r,n);t=T(t),o=ie(a,o),E([],[e],(function(e){var n=(e=e[0]).name+"."+t;function a(){ce(`Cannot call ${n} due to unbound types`,l)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),i&&e.registeredClass.pureVirtualFunctions.push(t);var c=e.registeredClass.instancePrototype,f=c[t];return void 0===f||void 0===f.overloadTable&&f.className!==e.name&&f.argCount===r-2?(a.argCount=r-2,a.className=e.name,c[t]=a):(Y(c,t,n),c[t].overloadTable[r-2]=a),E([],l,(function(a){var i=pe(n,a,e,o,s,u);return void 0===c[t].overloadTable?(i.argCount=r-2,c[t]=i):c[t].overloadTable[r-2]=i,[]})),[]}))},c:function(e,t,r,n,a,o,s,i,u,l){t=T(t),a=ie(n,a),E([],[e],(function(e){var n=(e=e[0]).name+"."+t,c={get:function(){ce(`Cannot access ${n} due to unbound types`,[r,s])},enumerable:!0,configurable:!0};return c.set=u?()=>{ce(`Cannot access ${n} due to unbound types`,[r,s])}:e=>{_(n+" is a read-only property")},Object.defineProperty(e.registeredClass.instancePrototype,t,c),E([],u?[r,s]:[r],(function(r){var s=r[0],c={get:function(){var t=he(this,e,n+" getter");return s.fromWireType(a(o,t))},enumerable:!0};if(u){u=ie(i,u);var f=r[1];c.set=function(t){var r=he(this,e,n+" setter"),a=[];u(l,r,f.toWireType(a,t)),de(a)}}return Object.defineProperty(e.registeredClass.instancePrototype,t,c),[]})),[]}))},L:function(e,t){R(e,{name:t=T(t),fromWireType:function(e){var t=ye.toValue(e);return function(e){e>=ge.reserved&&0==--ge.get(e).refcount&&ge.free(e)}(e),t},toWireType:function(e,t){return ye.toHandle(t)},argPackAdvance:8,readValueFromPointer:re,destructorFunction:null})},p:function(e,t,r){var n=w(r);R(e,{name:t=T(t),fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:8,readValueFromPointer:me(t,n),destructorFunction:null})},g:function(e,t,r,n,a){t=T(t);var o=w(r),s=e=>e;if(0===n){var i=32-8*r;s=e=>e<<i>>>i}var u=t.includes("unsigned");R(e,{name:t,fromWireType:s,toWireType:u?function(e,t){return this.name,t>>>0}:function(e,t){return this.name,t},argPackAdvance:8,readValueFromPointer:be(t,o,0!==n),destructorFunction:null})},e:function(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function a(e){var t=f,r=t[e>>=2],a=t[e+1];return new n(t.buffer,a,r)}R(e,{name:r=T(r),fromWireType:a,argPackAdvance:8,readValueFromPointer:a},{ignoreDuplicateRegistrations:!0})},q:function(e,t){var r="std::string"===(t=T(t));R(e,{name:t,fromWireType:function(e){var t,n=f[e>>2],a=e+4;if(r)for(var o=a,s=0;s<=n;++s){var i=a+s;if(s==n||0==l[i]){var u=C(o,i-o);void 0===t?t=u:(t+=String.fromCharCode(0),t+=u),o=i+1}}else{var c=new Array(n);for(s=0;s<n;++s)c[s]=String.fromCharCode(l[a+s]);t=c.join("")}return Re(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n,a="string"==typeof t;a||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||_("Cannot pass non-string to std::string"),n=r&&a?function(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n<=127?t++:n<=2047?t+=2:n>=55296&&n<=57343?(t+=4,++r):t+=3}return t}(t):t.length;var o=Ee(4+n+1),s=o+4;if(f[o>>2]=n,r&&a)!function(e,t,r){!function(e,t,r,n){if(!(n>0))return 0;for(var a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=a)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}t[r]=0}(e,l,t,r)}(t,s,n+1);else if(a)for(var i=0;i<n;++i){var u=t.charCodeAt(i);u>255&&(Re(s),_("String has UTF-16 code units that do not fit in 8 bits")),l[s+i]=u}else for(i=0;i<n;++i)l[s+i]=t[i];return null!==e&&e.push(Re,o),o},argPackAdvance:8,readValueFromPointer:re,destructorFunction:function(e){Re(e)}})},l:function(e,t,r){var n,a,o,s,i;r=T(r),2===t?(n=$e,a=Te,s=Pe,o=()=>c,i=1):4===t&&(n=Ae,a=Se,s=je,o=()=>f,i=2),R(e,{name:r,fromWireType:function(e){for(var r,a=f[e>>2],s=o(),u=e+4,l=0;l<=a;++l){var c=e+4+l*t;if(l==a||0==s[c>>i]){var d=n(u,c-u);void 0===r?r=d:(r+=String.fromCharCode(0),r+=d),u=c+t}}return Re(e),r},toWireType:function(e,n){"string"!=typeof n&&_("Cannot pass non-string to C++ string type "+r);var o=s(n),u=Ee(4+o+t);return f[u>>2]=o>>i,a(n,u+4,o+t),null!==e&&e.push(Re,u),u},argPackAdvance:8,readValueFromPointer:re,destructorFunction:function(e){Re(e)}})},s:function(e,t){R(e,{isVoid:!0,name:t=T(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},y:function(){throw 1/0},C:function(e,t,r,n,a,o,s){return-52},D:function(e,t,r,n,a,o){},f:function(){y("")},m:Ce,z:function(e){var t,r=l.length,n=2147483648;if((e>>>=0)>n)return!1;for(var a=1;a<=4;a*=2){var o=r*(1+.2/a);if(o=Math.min(o,e+100663296),Oe(Math.min(n,(t=Math.max(e,o))+(65536-t%65536)%65536)))return!0}return!1},E:function(e,t){var r=0;return Me().forEach((function(n,a){var o=t+r;f[e+4*a>>2]=o,function(e,t){for(var r=0;r<e.length;++r)s[t++>>0]=e.charCodeAt(r);s[t>>0]=0}(n,o),r+=n.length+1})),0},F:function(e,t){var r=Me();f[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),f[t>>2]=n,0},h:function(e){throw"exit("+e+")"},i:function(e){return 52},o:function(e,t,r,n){return 52},t:function(e,t,r,n,a){return 70},J:function(e,t,r,n){for(var a=0,o=0;o<r;o++){var s=f[t>>2],i=f[t+4>>2];t+=8;for(var u=0;u<i;u++)ke(e,l[s+u]);a+=i}return f[n>>2]=a,0},x:function(e,t,r){var n=Be();try{return oe(e)(t,r)}catch(e){if(Le(n),e!==e+0)throw e;Ie(1,0)}},v:function(e,t,r,n){var a=Be();try{return oe(e)(t,r,n)}catch(e){if(Le(a),e!==e+0)throw e;Ie(1,0)}},w:function(e,t,r,n,a){var o=Be();try{return oe(e)(t,r,n,a)}catch(e){if(Le(o),e!==e+0)throw e;Ie(1,0)}},a:h};e.getTempRet0=Ue,e.setTempRet0=De;var Ee,Re,xe,Ie,De,Ue,Be,Le,Ve={a:We};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(fetch("jassub-worker-modern.wasm"),Ve):WebAssembly.instantiate(e.wasm,Ve)).then((function(r){a=(r.instance||r).exports,e._malloc=Ee=a.N,Re=a.O,xe=a.P,e.__embind_initialize_bindings=a.Q,Ie=a.S,De=a.T,Ue=a.U,Be=a.V,Le=a.W,a.X,a.Y,a.Z,a._,g=a.R,function(e){e.M()}(a),t(e)})),e.ready};const read_=(e,t)=>{const r=new XMLHttpRequest;return r.open("GET",e,!1),r.responseType=t?"arraybuffer":"text",r.send(null),r.response},readAsync=(e,t,r)=>{const n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{if((200===n.status||0===n.status)&&n.response)return t(n.response)},n.onerror=r,n.send(null)};if(Date.now||(Date.now=()=>(new Date).getTime()),"performance"in self||(self.performance={now:()=>Date.now()}),typeof console>"u"){const e=(e,t)=>{postMessage({target:"console",command:e,content:JSON.stringify(Array.prototype.slice.call(t))})};console={log:function(){e("log",arguments)},debug:function(){e("debug",arguments)},info:function(){e("info",arguments)},warn:function(){e("warn",arguments)},error:function(){e("error",arguments)}},console.log("Detected lack of console, overridden console")}let lastCurrentTime=0;const rate=1;let rafId=null,nextIsRaf=!1,lastCurrentTimeReceivedAt=Date.now(),targetFps=24,useLocalFonts=!1,blendMode="js",availableFonts={};const fontMap_={};let fontId=0,debug;self.width=0,self.height=0;let asyncRender=!1;self.addFont=({font:e})=>asyncWrite(e);const findAvailableFonts=e=>{(e=e.trim().toLowerCase()).startsWith("@")&&(e=e.substring(1)),!fontMap_[e]&&(fontMap_[e]=!0,availableFonts[e]?asyncWrite(availableFonts[e]):useLocalFonts&&postMessage({target:"getLocalFont",font:e}))},asyncWrite=e=>{"string"==typeof e?readAsync(e,(e=>{allocFont(new Uint8Array(e))}),console.error):allocFont(e)},allocFont=e=>{const t=_malloc(e.byteLength);self.HEAPU8.set(e,t),jassubObj.addFont("font-"+fontId++,t,e.byteLength),jassubObj.reloadFonts()},processAvailableFonts=e=>{if(!availableFonts)return;const t=parseAss(e);for(let e=0;e<t.length;e++)for(let r=0;r<t[e].body.length;r++)"Style"===t[e].body[r].key&&findAvailableFonts(t[e].body[r].value.Fontname);const r=/\\fn([^\\}]*?)[\\}]/g;let n;for(;null!==(n=r.exec(e));)findAvailableFonts(n[1])};self.setTrack=({content:e})=>{processAvailableFonts(e),dropAllBlur&&(e=dropBlur(e)),jassubObj.createTrackMem(e),subtitleColorSpace=libassYCbCrMap[jassubObj.trackColorSpace],postMessage({target:"verifyColorSpace",subtitleColorSpace})},self.getColorSpace=()=>postMessage({target:"verifyColorSpace",subtitleColorSpace}),self.freeTrack=()=>{jassubObj.removeTrack()},self.setTrackByUrl=({url:e})=>{self.setTrack({content:read_(e)})};const getCurrentTime=()=>{const e=(Date.now()-lastCurrentTimeReceivedAt)/1e3;return _isPaused?lastCurrentTime:(e>5&&(console.error("Didn't received currentTime > 5 seconds. Assuming video was paused."),setIsPaused(!0)),lastCurrentTime+e*rate)},setCurrentTime=e=>{lastCurrentTime=e,lastCurrentTimeReceivedAt=Date.now(),rafId||(nextIsRaf?rafId=requestAnimationFrame(renderLoop):(renderLoop(),setTimeout((()=>{nextIsRaf=!1}),20)))};let _isPaused=!0;const setIsPaused=e=>{e!==_isPaused&&(_isPaused=e,e?rafId&&(clearTimeout(rafId),rafId=null):(lastCurrentTimeReceivedAt=Date.now(),rafId=requestAnimationFrame(renderLoop)))},a="BT601",b="BT709",c="SMPTE240M",d="FCC",libassYCbCrMap=[null,a,null,a,a,b,b,c,c,d,d],render=(e,t)=>{const r={},n=performance.now(),a="wasm"===blendMode?jassubObj.renderBlend(e,t||0):jassubObj.renderImage(e,t||0);if(debug){const e=performance.now(),t=jassubObj.time;r.WASMRenderTime=t-n,r.WASMBitmapDecodeTime=e-t,r.JSRenderTime=Date.now()}if(0!==jassubObj.changed||t){const e=[],t=[];if(!a)return paintImages({images:e,buffers:t,times:r});if(asyncRender){const t=[];for(let r=a,n=0;n<jassubObj.count;r=r.next,++n){const n={w:r.w,h:r.h,x:r.x,y:r.y},a=r.image;t.push(createImageBitmap(new ImageData(self.HEAPU8C.subarray(a,a+n.w*n.h*4),n.w,n.h))),e.push(n)}Promise.all(t).then((t=>{for(let r=0;r<e.length;r++)e[r].image=t[r];debug&&(r.JSBitmapGenerationTime=Date.now()-r.JSRenderTime),paintImages({images:e,buffers:t,times:r})}))}else{for(let r=a,n=0;n<jassubObj.count;r=r.next,++n){const n={w:r.w,h:r.h,x:r.x,y:r.y,image:r.image};if(!offCanvasCtx){const e=self.wasmMemory.buffer.slice(r.image,r.image+r.w*r.h*4);t.push(e),n.image=e}e.push(n)}paintImages({images:e,buffers:t,times:r})}}else postMessage({target:"unbusy"})};self.demand=({time:e})=>{lastCurrentTime=e,render(e)};const renderLoop=e=>{rafId=0,render(getCurrentTime(),e),_isPaused||(rafId=requestAnimationFrame(renderLoop))},paintImages=({times:e,images:t,buffers:r})=>{const n={target:"render",asyncRender,images:t,times:e,width:self.width,height:self.height,colorSpace:subtitleColorSpace};if(offscreenRender){(offCanvas.height!==self.height||offCanvas.width!==self.width)&&(offCanvas.width=self.width,offCanvas.height=self.height),offCanvasCtx.clearRect(0,0,self.width,self.height);for(const e of t)e.image&&(asyncRender?(offCanvasCtx.drawImage(e.image,e.x,e.y),e.image.close()):(bufferCanvas.width=e.w,bufferCanvas.height=e.h,bufferCtx.putImageData(new ImageData(self.HEAPU8C.subarray(e.image,e.image+e.w*e.h*4),e.w,e.h),0,0),offCanvasCtx.drawImage(bufferCanvas,e.x,e.y)));if("hybrid"===offscreenRender){if(!t.length)return postMessage(n);debug&&(e.bitmaps=t.length);try{const e=offCanvas.transferToImageBitmap();n.images=[{image:e,x:0,y:0}],n.asyncRender=!0,postMessage(n,[e])}catch{postMessage({target:"unbusy"})}}else{if(debug){e.JSRenderTime=Date.now()-e.JSRenderTime-(e.JSBitmapGenerationTime||0);let r=0;for(const t in e)r+=e[t];console.log("Bitmaps: "+t.length+" Total: "+(0|r)+"ms",e)}postMessage({target:"unbusy"})}}else postMessage(n,r)},parseAss=e=>{let t,r,n,a,o,s,i,u,l,c;const f=[],d=e.split(/[\r\n]+/g);for(u=0;u<d.length;u++)if(t=d[u].match(/^\[(.*)\]$/),t)r=null,f.push({name:t[1],body:[]});else{if(/^\s*$/.test(d[u])||0===f.length)continue;if(c=f[f.length-1].body,";"===d[u][0])c.push({type:"comment",value:d[u].substring(1)});else{if(a=d[u].split(":"),o=a[0],s=a.slice(1).join(":").trim(),(r||"Format"===o)&&(s=s.split(","),r&&s.length>r.length&&(n=s.slice(r.length-1).join(","),s=s.slice(0,r.length-1),s.push(n)),s=s.map((e=>e.trim())),r)){for(i={},l=0;l<s.length;l++)i[r[l]]=s[l];s=i}"Format"===o&&(r=s),c.push({key:o,value:s})}}return f},blurRegex=/\\blur(?:[0-9]+\.)?[0-9]+/gm,dropBlur=e=>e.replace(blurRegex,""),requestAnimationFrame=(()=>{let e=0;return t=>{const r=Date.now();if(0===e)e=r+1e3/targetFps;else for(;r+2>=e;)e+=1e3/targetFps;const n=Math.max(e-r,0);return setTimeout(t,n)}})(),_applyKeys=(e,t)=>{for(const r of Object.keys(e))t[r]=e[r]};let offCanvas,offCanvasCtx,offscreenRender,bufferCanvas,bufferCtx,jassubObj,subtitleColorSpace,dropAllBlur,_malloc;self.init=data=>{try{const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(!(e instanceof WebAssembly.Module&&new WebAssembly.Instance(e)instanceof WebAssembly.Instance))throw new Error("WASM not supported")}catch(e){console.warn(e),eval(read_(data.legacyWasmUrl))}const _fetch=fetch,wasm=!WebAssembly.instantiateStreaming&&read_(data.wasmUrl,!0);WebAssembly.instantiateStreaming&&(self.fetch=e=>_fetch(data.wasmUrl)),Module({wasm}).then((e=>{_malloc=e._malloc,self.width=data.width,self.height=data.height,blendMode=data.blendMode,asyncRender=data.asyncRender,asyncRender&&typeof createImageBitmap>"u"&&(asyncRender=!1,console.error("'createImageBitmap' needed for 'asyncRender' unsupported!")),availableFonts=data.availableFonts,debug=data.debug,targetFps=data.targetFps||targetFps,useLocalFonts=data.useLocalFonts,dropAllBlur=data.dropAllBlur;const t=data.fallbackFont.toLowerCase();jassubObj=new e.JASSUB(self.width,self.height,t||null,debug),t&&findAvailableFonts(t);let r=data.subContent;r||(r=read_(data.subUrl)),processAvailableFonts(r),dropAllBlur&&(r=dropBlur(r));for(const e of data.fonts||[])asyncWrite(e);jassubObj.createTrackMem(r),subtitleColorSpace=libassYCbCrMap[jassubObj.trackColorSpace],jassubObj.setDropAnimations(data.dropAllAnimations||0),(data.libassMemoryLimit>0||data.libassGlyphLimit>0)&&jassubObj.setMemoryLimits(data.libassGlyphLimit||0,data.libassMemoryLimit||0),postMessage({target:"ready"}),postMessage({target:"verifyColorSpace",subtitleColorSpace})}))},self.offscreenCanvas=({transferable:e})=>{offCanvas=e[0],offCanvasCtx=offCanvas.getContext("2d"),asyncRender||(bufferCanvas=new OffscreenCanvas(self.height,self.width),bufferCtx=bufferCanvas.getContext("2d",{desynchronized:!0})),offscreenRender=!0},self.detachOffscreen=()=>{offCanvas=new OffscreenCanvas(self.height,self.width),offCanvasCtx=offCanvas.getContext("2d",{desynchronized:!0}),offscreenRender="hybrid"},self.canvas=({width:e,height:t,force:r})=>{if(null==e)throw new Error("Invalid canvas size specified");self.width=e,self.height=t,jassubObj&&jassubObj.resizeCanvas(e,t),r&&render(lastCurrentTime,!0)},self.video=({currentTime:e,isPaused:t,rate:r})=>{null!=e&&setCurrentTime(e),null!=t&&setIsPaused(t),r=r||r},self.destroy=()=>{jassubObj.quitLibrary()},self.createEvent=({event:e})=>{_applyKeys(e,jassubObj.getEvent(jassubObj.allocEvent()))},self.getEvents=()=>{const e=[];for(let t=0;t<jassubObj.getEventCount();t++){const{Start:r,Duration:n,ReadOrder:a,Layer:o,Style:s,MarginL:i,MarginR:u,MarginV:l,Name:c,Text:f,Effect:d}=jassubObj.getEvent(t);e.push({Start:r,Duration:n,ReadOrder:a,Layer:o,Style:s,MarginL:i,MarginR:u,MarginV:l,Name:c,Text:f,Effect:d})}postMessage({target:"getEvents",events:e})},self.setEvent=({event:e,index:t})=>{_applyKeys(e,jassubObj.getEvent(t))},self.removeEvent=({index:e})=>{jassubObj.removeEvent(e)},self.createStyle=({style:e})=>{_applyKeys(e,jassubObj.getStyle(jassubObj.allocStyle()))},self.getStyles=()=>{const e=[];for(let t=0;t<jassubObj.getStyleCount();t++){const{Name:r,FontName:n,FontSize:a,PrimaryColour:o,SecondaryColour:s,OutlineColour:i,BackColour:u,Bold:l,Italic:c,Underline:f,StrikeOut:d,ScaleX:p,ScaleY:h,Spacing:g,Angle:y,BorderStyle:v,Outline:m,Shadow:b,Alignment:C,MarginL:w,MarginR:$,MarginV:T,Encoding:P,treat_fontname_as_pattern:A,Blur:S,Justify:j}=jassubObj.getStyle(t);e.push({Name:r,FontName:n,FontSize:a,PrimaryColour:o,SecondaryColour:s,OutlineColour:i,BackColour:u,Bold:l,Italic:c,Underline:f,StrikeOut:d,ScaleX:p,ScaleY:h,Spacing:g,Angle:y,BorderStyle:v,Outline:m,Shadow:b,Alignment:C,MarginL:w,MarginR:$,MarginV:T,Encoding:P,treat_fontname_as_pattern:A,Blur:S,Justify:j})}postMessage({target:"getStyles",time:Date.now(),styles:e})},self.setStyle=({style:e,index:t})=>{_applyKeys(e,jassubObj.getStyle(t))},self.removeStyle=({index:e})=>{jassubObj.removeStyle(e)},onmessage=({data:e})=>{if(!self[e.target])throw new Error("Unknown event target "+e.target);self[e.target](e)};