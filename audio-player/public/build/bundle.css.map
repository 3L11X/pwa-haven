{"version":3,"file":"build/bundle.css","mappings":"AA4BE,sBAAQ,wBACmB,CACzB,qEAAuD,CACxD,iCAEkB,GACb,YACW,CACd,KACK,OACI,CACT;AAtCL,q9DAAq9D,C;AC0Bn9D,uBAAU,cACO,CAChB,6BACe,0CAC6B,CAC5C,sBACQ,YACM,CACb,kBAAmB,CACnB,sBAAuB;AAnC3B,qqEAAqqE,C;ACgTnqE,+BAAG,gBACgB,CAClB,6CACe,YACD,CACd,kCACI,kBACgB,CACnB,eAAgB,CAChB,cAAe,CAChB,kDACoB,uBACK,CACxB,sBAAuB,CACvB,QAAS,CACT,cAAe,CACf,UAAW,CACZ,wDAE0B,YACZ,CACd,iFAEmD,UACvC,CACZ,oEACsC,UAC1B,CACX,WAAY,CACb,wEAE0C,QAChC,CACT,OAAQ,CACR,iBAAkB,CAClB,kBAAmB,CACnB,uBAAwB,CACxB,eAAgB,CAChB,wBAAyB,CAC1B,oEACsC,QAC5B,CACT,OAAQ,CACR,iBAAkB,CAClB,kBAAmB,CACnB,uBAAwB,CACxB,eAAgB,CAChB,wBAAyB,CACzB,WAAY,CACb,8EAEgD,WACnC,CACZ,UAAW,CACX,eAAgB,CACjB,0EAC4C,WAC/B,CACZ,UAAW,CACX,eAAgB,CACjB,kDAEoB,WACP,CACb,iFAEmD,8FAC6C,CAChG,oEAEsC,8FAC0D,CAChG,uCAES,cACO,CAChB,oCAEM,YACQ,CACb,aAAc,CACd,YAAa,CACb,kBAAmB,CACnB,sBAAuB,CACxB,sCAEQ,YACM,CACb,kBAAmB,CACnB,sBAAuB,CACxB,oCAEM,iBACa,CAClB,aAAc,CACf,0CACY,iBACO,CAClB,kBAAmB,CACnB,aAAc,CACf,oCACM,WACO;AAtZhB,ywnBAAywnB,C;ACgFvwnB,wBAAU,cACO,CAChB,4BACa,qBACU;AApF1B,imIAAimI,C;AC0F/lI,gBAAG,gBACgB,CAClB,8BACe,wBACW,CACzB,WAAY;AA/FhB,y2KAAy2K,C","sources":["webpack:///./src/modules/InstallPrompt.svelte","webpack:///./src/modules/SongList.svelte","webpack:///./src/modules/Player.svelte","webpack:///../shared/RecentFiles.svelte","webpack:///./src/App.svelte"],"sourcesContent":["<script>\r\n  let deferredPrompt\r\n\r\n  window.addEventListener('beforeinstallprompt', e => {\r\n    e.preventDefault()\r\n    deferredPrompt = e\r\n  })\r\n  async function promptInstall() {\r\n    deferredPrompt.prompt()\r\n    const { outcome } = await deferredPrompt.userChoice\r\n    if (outcome === 'accepted') {\r\n      deferredPrompt = null\r\n    }\r\n  }\r\n  function dismiss() {\r\n    deferredPrompt = null\r\n  }\r\n</script>\r\n\r\n{#if deferredPrompt}\r\n  <div class=\"alert alert-success filled-dm show\" on:click={promptInstall}>\r\n    <h4 class=\"alert-heading\">Install</h4>\r\n    <button class=\"close\" type=\"button\" on:click={dismiss}><span>Ã—</span></button>\r\n    Click here to install the app for more features!\r\n  </div>\r\n{/if}\r\n\r\n<style>\r\n  .alert {\r\n    display: block !important;\r\n    animation: fly-in 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);\r\n  }\r\n\r\n  @keyframes fly-in {\r\n    0% {\r\n      right: -50rem;\r\n    }\r\n    100% {\r\n      right: 0;\r\n    }\r\n  }\r\n</style>\r\n","<script>\r\n  import { toTS } from '../../../shared/util.js'\r\n\r\n  export let current\r\n  export let songs\r\n  function select(song) {\r\n    if (song !== current) current = song\r\n  }\r\n</script>\r\n\r\n<div class=\"col-md-5 bg-dark overflow-y-scroll h-half h-md-full p-20\">\r\n  {#if songs.length}\r\n    {#each songs as song}\r\n      <div class=\"d-flex w-full pointer font-size-20 {song === current ? 'text-primary' : 'text-muted'}\" on:click={select(song)}>\r\n        <div class=\"material-icons font-size-20 center pr-20\">\r\n          {song === current ? 'volume_up' : 'play_arrow'}\r\n        </div>\r\n        <div class=\"text-truncate\">{[song.number, song.name].filter(s => s).join('. ')}</div>\r\n        <div class=\"ml-auto pl-20\">{toTS(song.duration)}</div>\r\n      </div>\r\n    {/each}\r\n  {:else}\r\n    <div class=\"font-size-24 font-weight-bold center text-center h-full pointer\">Drag and drop, paste or click here to select a file/folder to play.</div>\r\n  {/if}\r\n</div>\r\n\r\n<style>\r\n  .pointer {\r\n    cursor: pointer;\r\n  }\r\n  .pointer:hover {\r\n    color: var(--dm-base-text-color) !important;\r\n  }\r\n  .center {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n</style>\r\n","<script>\r\n  import { toTS } from '../../../shared/util.js'\r\n  import SongList from './SongList.svelte'\r\n  import Peer from '../../../shared/Peer.js'\r\n  import { URLFile } from '../../../shared/URLFile.js'\r\n\r\n  export let name = ''\r\n  let src = null\r\n  let audio = null\r\n  let volume = localStorage.getItem('volume') || 1\r\n  $: localStorage.setItem('volume', volume)\r\n  $: progress = currentTime / duration\r\n  $: targetTime = (!paused && currentTime) || targetTime\r\n  let current = null\r\n  $: setCurrent(songs)\r\n  function setCurrent(songs) {\r\n    if (!current && songs.length) current = songs[0]\r\n  }\r\n  $: setSource(current)\r\n  export let songs = []\r\n  let duration = 0.1\r\n  let currentTime = 0\r\n  let paused = true\r\n  let muted = false\r\n  let loop = false\r\n  let wasPaused = true\r\n  let shuffle = false\r\n  let cover = './512.png'\r\n  let defaultCover = './512.png'\r\n  $: navigator.mediaSession?.setPositionState({\r\n    duration: duration || 0,\r\n    playbackRate: 1,\r\n    position: currentTime || 0\r\n  })\r\n  $: updateMedia(current, cover)\r\n  function updateMedia(current, cover) {\r\n    if ('mediaSession' in navigator) {\r\n      navigator.mediaSession.metadata = new MediaMetadata({\r\n        title: current?.name || 'Audio Player',\r\n        artist: current?.artist || '',\r\n        album: current?.album || '',\r\n        artwork: [\r\n          {\r\n            src: cover,\r\n            sizes: '256x256',\r\n            type: 'image/jpg'\r\n          }\r\n        ]\r\n      })\r\n    }\r\n  }\r\n\r\n  if ('mediaSession' in navigator) {\r\n    navigator.mediaSession.setActionHandler('play', playPause)\r\n    navigator.mediaSession.setActionHandler('pause', playPause)\r\n    navigator.mediaSession.setActionHandler('nexttrack', playNext)\r\n    navigator.mediaSession.setActionHandler('previoustrack', playLast)\r\n  }\r\n\r\n  let presentationRequest = null\r\n  let presentationConnection = null\r\n  let presentationPort = null\r\n  let canCast = false\r\n\r\n  $: updateCastTime(currentTime)\r\n\r\n  function updateCastTime(currentTime) {\r\n    if (presentationPort?.readyState === 'open') {\r\n      presentationPort.send(JSON.stringify({ current: currentTime }))\r\n    }\r\n  }\r\n\r\n  if ('PresentationRequest' in window) {\r\n    const handleAvailability = aval => {\r\n      canCast = !!aval\r\n    }\r\n    presentationRequest = new PresentationRequest(['build/cast.html'])\r\n    presentationRequest.addEventListener('connectionavailable', e => initCast(e))\r\n    navigator.presentation.defaultRequest = presentationRequest\r\n    presentationRequest.getAvailability().then(aval => {\r\n      aval.onchange = e => handleAvailability(e.target.value)\r\n      handleAvailability(aval.value)\r\n    })\r\n  }\r\n\r\n  function toggleCast() {\r\n    if (audio.readyState) {\r\n      if (presentationConnection) {\r\n        presentationConnection?.terminate()\r\n      } else {\r\n        presentationRequest.start()\r\n      }\r\n    }\r\n  }\r\n  let peer = null\r\n  $: updateCastState(audio?.readyState && current)\r\n  async function updateCastState(current) {\r\n    if (current && presentationPort?.readyState === 'open') {\r\n      const stream = audio.captureStream()\r\n      peer.pc.addTrack(stream.getAudioTracks()[0], stream)\r\n      paused = false // pauses for some reason\r\n      presentationPort.send(\r\n        JSON.stringify({\r\n          duration: current.duration,\r\n          current: currentTime,\r\n          artist: current.artist,\r\n          title: current.name\r\n        })\r\n      )\r\n      if (current.cover) {\r\n        const buffer = await current.cover.arrayBuffer()\r\n        const array = new Uint8Array(buffer)\r\n        for (let pos = 0; pos < array.length; pos += 16000) {\r\n          const sliced = array.slice(pos, pos + 16000)\r\n          presentationPort.send(sliced)\r\n        }\r\n        presentationPort.send(JSON.stringify({ ended: true }))\r\n      }\r\n    }\r\n  }\r\n  function initCast(event) {\r\n    peer = new Peer({ polite: true })\r\n\r\n    presentationConnection = event.connection\r\n    presentationConnection.addEventListener('terminate', () => {\r\n      presentationConnection = null\r\n      peer = null\r\n    })\r\n\r\n    peer.signalingPort.onmessage = ({ data }) => {\r\n      presentationConnection.send(data)\r\n    }\r\n\r\n    presentationConnection.addEventListener('message', ({ data }) => {\r\n      peer.signalingPort.postMessage(data)\r\n    })\r\n\r\n    peer.dc.onopen = () => {\r\n      presentationPort = peer.pc.createDataChannel('current', { negotiated: true, id: 2 })\r\n      presentationConnection.addEventListener('terminate', () => presentationPort.close())\r\n      presentationPort.onopen = () => updateCastState(current)\r\n    }\r\n  }\r\n\r\n  function setSource(song) {\r\n    if (src) URL.revokeObjectURL(src)\r\n    if (song) {\r\n      src = song.file.url || URL.createObjectURL(song.file)\r\n      name = song.name\r\n      setCover(song.cover)\r\n    } else {\r\n      src = null\r\n      name = ''\r\n    }\r\n  }\r\n  function setCover(file) {\r\n    if (cover) URL.revokeObjectURL(cover)\r\n    if (file) {\r\n      cover = file.url || URL.createObjectURL(file)\r\n    } else {\r\n      cover = defaultCover\r\n    }\r\n  }\r\n\r\n  function handleMouseDown({ target }) {\r\n    wasPaused = paused\r\n    paused = true\r\n    targetTime = target.value * duration\r\n  }\r\n  function handleMouseUp() {\r\n    paused = wasPaused\r\n    currentTime = targetTime\r\n  }\r\n  function handleProgress({ target }) {\r\n    targetTime = target.value * duration\r\n  }\r\n\r\n  function playPause() {\r\n    paused = !paused\r\n  }\r\n  function toggleMute() {\r\n    muted = !muted\r\n  }\r\n  function toggleLoop() {\r\n    loop = !loop\r\n  }\r\n  function playNext() {\r\n    current = songs[(songs.indexOf(current) + 1) % songs.length]\r\n  }\r\n  function playLast() {\r\n    const index = songs.indexOf(current)\r\n    current = songs[index === 0 ? songs.length - 1 : index - 1]\r\n  }\r\n  function toggleShuffle() {\r\n    shuffle = !shuffle\r\n    if (shuffle) {\r\n      songs = songs.sort(() => 0.5 - Math.random())\r\n    } else {\r\n      songs = songs.sort((a, b) => (a.file.name > b.file.name ? 1 : b.file.name > a.file.name ? -1 : 0))\r\n    }\r\n  }\r\n\r\n  function handleKeydown({ key }) {\r\n    switch (key) {\r\n      case ' ':\r\n        playPause()\r\n        break\r\n      case 'n':\r\n        playNext()\r\n        break\r\n      case 'm':\r\n        muted = !muted\r\n        break\r\n      case 'c':\r\n        toggleCast()\r\n        break\r\n      case 'ArrowLeft':\r\n        currentTime = Math.max(currentTime - 2, 0)\r\n        break\r\n      case 'ArrowRight':\r\n        currentTime = Math.min(currentTime + 2, duration)\r\n        break\r\n      case 'ArrowUp':\r\n        volume = Math.min(1, volume + 0.05)\r\n        break\r\n      case 'ArrowDown':\r\n        volume = Math.max(0, volume - 0.05)\r\n        break\r\n    }\r\n  }\r\n</script>\r\n\r\n<svelte:window on:keydown={handleKeydown} />\r\n\r\n<!-- svelte-ignore a11y-media-has-caption -->\r\n<audio\r\n  {src}\r\n  bind:this={audio}\r\n  autoplay\r\n  bind:volume\r\n  bind:duration\r\n  bind:currentTime\r\n  bind:paused\r\n  bind:muted\r\n  {loop}\r\n  on:ended={() => !loop && playNext()}\r\n  on:loadedmetadata={updateCastState} />\r\n<div class=\"content-wrapper row overflow-hidden\">\r\n  <div class=\"col-md-7 p-20 center h-half h-md-full bg-dark\">\r\n    <img src={cover} alt=\"cover\" class=\"shadow-lg pointer\" on:click={playPause} />\r\n  </div>\r\n  <SongList {songs} bind:current />\r\n</div>\r\n<nav class=\"navbar navbar-fixed-bottom p-0 d-flex flex-column border-0 shadow-lg bg-dark-light\">\r\n  <div class=\"d-flex w-full prog\">\r\n    <input\r\n      class=\"w-full top-0\"\r\n      type=\"range\"\r\n      min=\"0\"\r\n      max=\"1\"\r\n      bind:value={progress}\r\n      on:mousedown={handleMouseDown}\r\n      on:mouseup={handleMouseUp}\r\n      on:input={handleProgress}\r\n      on:touchstart={handleMouseDown}\r\n      on:touchend={handleMouseUp}\r\n      step=\"any\"\r\n      style=\"--value: {progress * 100}%\" />\r\n  </div>\r\n  <div class=\"d-flex w-full flex-grow-1 px-20 justify-content-between\">\r\n    <div class=\"d-flex align-items-center\">\r\n      <span class=\"material-icons font-size-20 ctrl pointer\" type=\"button\" on:click={playLast}> skip_previous </span>\r\n      <span class=\"material-icons font-size-24 ctrl pointer\" type=\"button\" on:click={playPause}>\r\n        {paused ? 'play_arrow' : 'pause'}\r\n      </span>\r\n      <span class=\"material-icons font-size-20 ctrl pointer\" type=\"button\" on:click={playNext}> skip_next </span>\r\n      <div class=\"text-muted center ml-10 text-nowrap\">\r\n        {toTS(targetTime, 3)} / {toTS(duration, 3)}\r\n      </div>\r\n    </div>\r\n    <div class=\"center px-20 mw-0\">\r\n      <div class=\"text-truncate text-muted\">{[current?.artist, current?.name].filter(c => c).join(' - ')}</div>\r\n    </div>\r\n    <div class=\"d-flex align-items-center\">\r\n      <!-- svelte-ignore missing-declaration -->\r\n      {#if 'PresentationRequest' in window && canCast && (!current || current.file instanceof File || current.file instanceof URLFile)}\r\n        <span class=\"material-icons font-size-20 ctrl pointer\" title=\"Cast Video [C]\" data-name=\"toggleCast\" on:click={toggleCast}>\r\n          {presentationConnection ? 'cast_connected' : 'cast'}\r\n        </span>\r\n      {/if}\r\n      <span class=\"material-icons font-size-20 ctrl pointer\" type=\"button\" on:click={toggleMute}>\r\n        {muted ? 'volume_off' : 'volume_up'}\r\n      </span>\r\n      <input class=\"ml-auto px-5 h-half\" type=\"range\" min=\"0\" max=\"1\" bind:value={volume} step=\"any\" style=\"--value: {volume * 100}%\" />\r\n      <span class=\"material-icons font-size-20 ctrl pointer\" type=\"button\" on:click={toggleLoop}>\r\n        {loop ? 'repeat_one' : 'repeat'}\r\n      </span>\r\n      <span class=\"material-icons font-size-20 ctrl pointer\" type=\"button\" on:click={toggleShuffle}>\r\n        {shuffle ? 'shuffle' : 'sort'}\r\n      </span>\r\n    </div>\r\n  </div>\r\n</nav>\r\n\r\n<style>\r\n  * {\r\n    user-select: none;\r\n  }\r\n  img:not([src]) {\r\n    display: none;\r\n  }\r\n  img {\r\n    object-fit: contain;\r\n    max-height: 100%;\r\n    max-width: 100%;\r\n  }\r\n  input[type='range'] {\r\n    -webkit-appearance: none;\r\n    background: transparent;\r\n    margin: 0;\r\n    cursor: pointer;\r\n    height: 8px;\r\n  }\r\n\r\n  input[type='range']:focus {\r\n    outline: none;\r\n  }\r\n\r\n  input[type='range']::-webkit-slider-runnable-track {\r\n    height: 3px;\r\n  }\r\n  input[type='range']::-moz-range-track {\r\n    height: 3px;\r\n    border: none;\r\n  }\r\n\r\n  input[type='range']::-webkit-slider-thumb {\r\n    height: 0;\r\n    width: 0;\r\n    border-radius: 50%;\r\n    background: #ff3c00;\r\n    -webkit-appearance: none;\r\n    appearance: none;\r\n    transition: all 0.1s ease;\r\n  }\r\n  input[type='range']::-moz-range-thumb {\r\n    height: 0;\r\n    width: 0;\r\n    border-radius: 50%;\r\n    background: #ff3c00;\r\n    -webkit-appearance: none;\r\n    appearance: none;\r\n    transition: all 0.1s ease;\r\n    border: none;\r\n  }\r\n\r\n  input[type='range']:hover::-webkit-slider-thumb {\r\n    height: 12px;\r\n    width: 12px;\r\n    margin-top: -4px;\r\n  }\r\n  input[type='range']:hover::-moz-range-thumb {\r\n    height: 12px;\r\n    width: 12px;\r\n    margin-top: -4px;\r\n  }\r\n\r\n  input[type='range'] {\r\n    --volume: 0%;\r\n  }\r\n\r\n  input[type='range']::-webkit-slider-runnable-track {\r\n    background: linear-gradient(90deg, #ff3c00 var(--value), rgba(255, 255, 255, 0.2) var(--value));\r\n  }\r\n\r\n  input[type='range']::-moz-range-track {\r\n    background: linear-gradient(90deg, #ff3c00 var(--value), rgba(255, 255, 255, 0.2) var(--value));\r\n  }\r\n\r\n  .pointer {\r\n    cursor: pointer;\r\n  }\r\n\r\n  .ctrl {\r\n    width: 3.5rem;\r\n    height: 3.5rem;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n\r\n  .center {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n\r\n  .prog {\r\n    position: relative;\r\n    height: 0.2rem;\r\n  }\r\n  .prog input {\r\n    position: absolute;\r\n    margin-top: -0.7rem;\r\n    height: 1.4rem;\r\n  }\r\n  .mw-0 {\r\n    min-width: 0;\r\n  }\r\n</style>\r\n","<script context=\"module\">\r\n  import { get, set, createStore } from 'idb-keyval'\r\n\r\n  const supported = 'FileSystemFileHandle' in window\r\n\r\n  const asyncSome = async (arr, predicate) => {\r\n    for (let e of arr) {\r\n      if (await predicate(e)) return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  let db = null\r\n  export function initDb(appName) {\r\n    db = createStore(appName, 'recents')\r\n    get('recents', db).then(hand => {\r\n      handles = hand || []\r\n    })\r\n  }\r\n\r\n  let handles = []\r\n\r\n  async function handleSingleHandle(handle) {\r\n    if (!(await asyncSome(handles, recent => recent.isSameEntry(handle)))) {\r\n      handles.unshift(handle)\r\n      handles.length = Math.min(handles.length, 15)\r\n      set('recents', handles, db)\r\n    }\r\n  }\r\n  export async function updateRecents(files) {\r\n    if (supported && db) {\r\n      for (const file of files) {\r\n        handleSingleHandle(file instanceof FileSystemFileHandle ? file : await file.getAsFileSystemHandle())\r\n      }\r\n      set('recents', handles, db)\r\n    }\r\n  }\r\n</script>\r\n\r\n<script>\r\n  export let files = null\r\n  let recents = []\r\n  get('recents', db).then(async rec => {\r\n    recents = handles = await Promise.all(rec || [])\r\n  })\r\n  async function selectFile(handle) {\r\n    await handle.requestPermission({ mode: 'read' })\r\n    files = [await handle.getFile()]\r\n  }\r\n\r\n  export let handlePopup = () => {}\r\n</script>\r\n\r\n<div class=\"h-full my-0 bg-very-dark\">\r\n  <div class=\"container h-full py-20\">\r\n    <div class=\"py-20 d-flex flex-column h-full\">\r\n      <div class=\"font-weight-bold font-size-24 p-5\">Recent Files</div>\r\n      <hr class=\"w-full my-15\" />\r\n      <div class=\"overflow-y-auto\">\r\n        {#if supported}\r\n          {#each recents as recent}\r\n            <div class=\"p-5 pointer text-muted hover\" on:click={selectFile(recent)}>\r\n              <div class=\"ml-5\">{recent.name}</div>\r\n            </div>\r\n          {:else}\r\n            <div class=\"ml-5 p-5\">Your recent files will show up here!</div>\r\n          {/each}\r\n        {:else if window.chrome}\r\n          <div>\r\n            Your browser doesn't support recent files, but it could! Visit <code class=\"code\">chrome://flags</code> and enable <code class=\"code\">#file-system-access-api!</code>\r\n          </div>\r\n        {:else}\r\n          <div>Your browser doesn't support recent files.</div>\r\n        {/if}\r\n      </div>\r\n      <div class=\"py-20 pointer text-muted hover mt-auto\" on:click={handlePopup}>You can also drag-drop or paste files, or click here to select some!</div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<style>\r\n  .pointer {\r\n    cursor: pointer;\r\n  }\r\n  .hover:hover {\r\n    color: #fff !important;\r\n  }\r\n</style>\r\n","<script>\r\n  import InstallPrompt from './modules/InstallPrompt.svelte'\r\n  import Player from './modules/Player.svelte'\r\n  import { parseBlob } from 'music-metadata-browser'\r\n  import { handleItems, getSearchFiles, getLaunchFiles, filePopup } from '../../shared/inputHandler.js'\r\n  import { URLFile } from '../../shared/URLFile.js'\r\n  import RecentFiles, { initDb } from '../../shared/RecentFiles.svelte'\r\n\r\n  initDb('audio-player')\r\n\r\n  let name = ''\r\n  let files = []\r\n\r\n  navigator.serviceWorker.register('/sw.js')\r\n\r\n  // loading files\r\n  async function handleInput({ dataTransfer, clipboardData }) {\r\n    const items = clipboardData?.items || dataTransfer?.items\r\n    if (items) {\r\n      handleFiles(await handleItems(items, ['audio', 'image']))\r\n    }\r\n  }\r\n\r\n  if ('launchQueue' in window) {\r\n    getLaunchFiles().then(handleFiles)\r\n  }\r\n  async function handlePopup() {\r\n    if (!songs.length) {\r\n      handleFiles(await filePopup(['audio', 'image']))\r\n    }\r\n  }\r\n  let songs = []\r\n  $: handleFiles(files)\r\n  async function handleFiles(files) {\r\n    if (files?.length) {\r\n      const image = files.find(file => file.type.indexOf('image') === 0)\r\n      const audio = files.filter(file => file.type.indexOf('audio') === 0)\r\n      const songDataPromises = audio.map(async audio => {\r\n        let file = audio\r\n        if (!(file instanceof File)) {\r\n          const urlfile = new URLFile(file)\r\n          if (!((await urlfile.ready) instanceof Error)) {\r\n            file = urlfile\r\n          }\r\n        }\r\n        if (file instanceof File || file instanceof URLFile) {\r\n          const { common, format } = await parseBlob(file)\r\n          const name = common?.title || file.name.substring(0, file.name.lastIndexOf('.')) || file.name\r\n          const cover = (common?.picture?.length && new Blob([common.picture[0].data], { type: common.picture[0].format })) || image\r\n          return { file, name, artist: common?.artist, album: common?.album, cover, duration: format?.duration, number: common?.track?.no }\r\n        } else {\r\n          // if metadata can't be parsed, rely on good old regex and audio element x)\r\n          const filename = file.name.substring(0, file.name.lastIndexOf('.')) || file.name\r\n          const [match, number, artist, name] = filename.match(/(?:(^\\d*)\\.)?(?:(.*)-)?(.+)$/) || []\r\n          const duration = await new Promise(resolve => {\r\n            let audio = document.createElement('audio')\r\n            audio.preload = 'metadata'\r\n            audio.onloadedmetadata = () => {\r\n              resolve(audio.duration)\r\n              URL.revokeObjectURL(audio.src)\r\n              audio = null\r\n            }\r\n            audio.src = file.url\r\n          })\r\n          return { file, artist, name: name || filename, duration, number, cover: image }\r\n        }\r\n      })\r\n      songs = songs.concat(await Promise.all(songDataPromises)).sort((a, b) => (a.file.name > b.file.name ? 1 : b.file.name > a.file.name ? -1 : 0))\r\n    }\r\n  }\r\n  handleFiles(getSearchFiles(['audio', 'image']))\r\n</script>\r\n\r\n<div class=\"sticky-alerts d-flex flex-column-reverse\">\r\n  <InstallPrompt />\r\n</div>\r\n<div class=\"page-wrapper with-navbar-fixed-bottom\">\r\n  {#if !songs.length}\r\n    <RecentFiles bind:files {handlePopup} />\r\n  {:else}\r\n    <Player bind:name {songs} />\r\n  {/if}\r\n</div>\r\n\r\n<svelte:head>\r\n  <title>{name || 'Audio Player'}</title>\r\n</svelte:head>\r\n\r\n<svelte:window on:drop|preventDefault={handleInput} on:dragover|preventDefault on:paste|preventDefault={handleInput} />\r\n\r\n<style>\r\n  * {\r\n    user-select: none;\r\n  }\r\n  .sticky-alerts {\r\n    --sticky-alerts-top: auto;\r\n    bottom: 1rem;\r\n  }\r\n</style>\r\n"],"names":[],"sourceRoot":""}